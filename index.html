<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Monitor T-Zone ‚Äì Temperatura & Humedad</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
    body {
        font-family: Arial;
        background: #f3f3f3;
        padding: 20px;
    }
    .card {
        background: white;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 20px;
        box-shadow: 0 0 10px #0001;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
    }
    th, td {
        border: 1px solid #ccc;
        padding: 6px;
        text-align: center;
    }
    th {
        background: #eee;
    }
</style>
</head>

<body>

<h1>üìä Monitor de Temperatura y Humedad ‚Äì TZONE</h1>

<div class="card">
    <input type="file" id="archivoPDF">
    <button onclick="procesar()">Procesar PDF</button>
</div>

<div id="msgError" style="color:red; font-weight:bold;"></div>

<div class="card">
    <h2>Resultados Generales</h2>
    <p id="generalMax"></p>
    <p id="generalMin"></p>
</div>

<div class="card">
    <h2>Resumen por D√≠a</h2>
    <table id="tablaDias">
        <thead>
            <tr>
                <th>Fecha</th>
                <th>Temp M√°x</th>
                <th>Hora M√°x</th>
                <th>Temp M√≠n</th>
                <th>Hora M√≠n</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<div class="card">
    <h2>Gr√°fico</h2>
    <canvas id="grafico"></canvas>
</div>

<div class="card">
    <h2>Datos Completos</h2>
    <table id="tablaDatos">
        <thead>
            <tr>
                <th>Fecha</th>
                <th>Hora</th>
                <th>Temp (¬∞C)</th>
                <th>Humedad (%)</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>


<script>
let grafico = null;

async function procesar() {

    document.getElementById("msgError").innerText = "";

    const archivo = document.getElementById("archivoPDF").files[0];
    if (!archivo) {
        alert("Selecciona un archivo PDF primero.");
        return;
    }

    const formData = new FormData();
    formData.append("file", archivo);

    // URL DEL BACKEND EN RENDER (actualiza si cambia)
    const url = "https://tzone-backend-gqhn.onrender.com/procesar_pdf/";

    let respuesta = await fetch(url, {
        method: "POST",
        body: formData
    });

    let json = await respuesta.json();

    if (json.error) {
        document.getElementById("msgError").innerText = json.error;
        return;
    }

    const datos = json.datos;

    // -----------------------------
    // üü© Mostrar resumen general
    // -----------------------------
    document.getElementById("generalMax").innerHTML =
        `üî• <b>M√°xima:</b> ${json.resumen_general.temp_max}¬∞C ` +
        `(${json.resumen_general.fecha_max} ${json.resumen_general.hora_max})`;

    document.getElementById("generalMin").innerHTML =
        `‚ùÑÔ∏è <b>M√≠nima:</b> ${json.resumen_general.temp_min}¬∞C ` +
        `(${json.resumen_general.fecha_min} ${json.resumen_general.hora_min})`;

    // -----------------------------
    // üü© Llenar tabla por d√≠a
    // -----------------------------
    const tbodyDia = document.querySelector("#tablaDias tbody");
    tbodyDia.innerHTML = "";

    json.resumen_dias.forEach(d => {
        tbodyDia.innerHTML += `
            <tr>
                <td>${d.fecha}</td>
                <td>${d.temp_max}</td>
                <td>${d.hora_max}</td>
                <td>${d.temp_min}</td>
                <td>${d.hora_min}</td>
            </tr>`;
    });

    // -----------------------------
    // üü© Llenar tabla completa
    // -----------------------------
    const tbody = document.querySelector("#tablaDatos tbody");
    tbody.innerHTML = "";

    datos.forEach(r => {
        tbody.innerHTML += `
            <tr>
                <td>${r.fecha}</td>
                <td>${r.hora}</td>
                <td>${r.temp}</td>
                <td>${r.hum}</td>
            </tr>`;
    });

    // -----------------------------
    // üü© Gr√°fico (temperatura y humedad)
    // -----------------------------
    const ctx = document.getElementById("grafico").getContext("2d");

    if (grafico) grafico.destroy();

    grafico = new Chart(ctx, {
        type: "line",
        data: {
            labels: datos.map(d => d.fecha + " " + d.hora),
            datasets: [
                {
                    label: "Temperatura (¬∞C)",
                    data: datos.map(d => d.temp),
                    borderColor: "red",
                    backgroundColor: "rgba(255,0,0,0.2)",
                    tension: 0.3
                },
                {
                    label: "Humedad (%)",
                    data: datos.map(d => d.hum),
                    borderColor: "blue",
                    backgroundColor: "rgba(0,0,255,0.2)",
                    tension: 0.3
                }
            ]
        },
        options: { responsive: true }
    });
}
</script>

</body>
</html>
